/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(['./DvtToolkit', './DvtOverview'], function(dvt) {
  // Internal use only.  All APIs and functionality are subject to change at any time.

  // Map the D namespace to dvt, which is used to provide access across partitions.
  var D = dvt;
  
D.CU=function(a,b,c){this.Init(a,b,c)};(0,D.ca)("DvtTimelineOverview",D.CU);D.w.l(D.CU,D.mo,"DvtTimelineOverview");D.CU.prototype.Init=function(a,b,c){D.CU.o.Init.call(this,a,b,c);a=[D.M.xD(D.M.Dm("#aadd77",0.35)),"#aadd77",D.M.xD(D.M.so("#aadd77",0.5))];D.TO.Zl()&&(a=["#aadd77"]);this.E5=a;this.kma=(0,D.Qn)();this.qt=12};D.CU.prototype.yra=function(){return new D.DU(this)};
D.CU.prototype.Iu=function(a){D.CU.o.Iu.call(this,a);this.Eq=a.cT;this.jn=a.FMa;this.EY=a.rNa;this.F5=a.cqa;this.V5="#267DB3 #68C182 #FAD55C #ED6647 #8561C8 #6DDBDB #FFB54D #E371B2 #47BDEF #A2BF39 #A75DBA #F7F37B".split(" ");a.Zv&&(this.uq=new D.F(a.Zv));a="solid"==this.A("_","bs")?(0,window.parseInt)(this.A("_","bof"),10):1;var b="solid"==this.A("_as","bs")?(0,window.parseInt)(this.A("_as","bof"),10):1,c="solid"==this.A("_s","bs")?(0,window.parseInt)(this.A("_s","bof"),10):1;this.xX="none"!=this.Eq?
window.Math.max(b,c,a,1)/2+1:1;this.XO=this.Ra()?0:0.75;this.tja=[this.XO,this.XO,this.XO];this.DEa=new D.ag(250,this.E5,this.tja);this.lDa=new D.ag(180,this.E5,this.tja);a=this.Ra()?0:1;this.hAa=new D.I("#aadd77",a)};D.CU.prototype.gD=function(a,b,c,d,e,f){D.CU.o.gD.call(this,a,b,c,d,e,f,this.uq)};D.pU=function(a,b){for(var c="_mrk_"+b,d="_drn_"+b,e=a.Ja(),f=0;f<e;f++){var g=a.ha(f);if(null!=g&&(c==g.getId()||d==g.getId()))return g}return null};D.u=D.CU.prototype;D.u.iH=function(a){return a.getId().substr(5)};
D.u.A=function(a,b){return this.jAa[a+b]};D.u.ja=function(a){return null!=a.Pb?a.Pb.ja():a.ua().pc};D.u.na=function(a){return null!=a.Pb?a.Pb.na():a.ua().nc};D.u.uc=function(a){a=a.uc();null==a&&(a=this.Ra()?(this.Ga-this.vH()-4)/2:1);return a};D.u.yc=function(a){a=a.yc();null==a&&(a=1);return a};
D.u.zca=function(a,b){D.CU.o.zca.call(this,a,b);if(null!=this.jn){for(var c=(0,D.EU)(this,this.pb,this.Xb,a,b,this.qt),d=[],e=0;e<this.jn.length;e++){var f=this.jn[e];if(null==f.Qh){var g=c,h="_mrk_"+f.getId(),i=f.rb(),k=f.I6,l=f.eba();null==l&&(l=this.XO,0==l&&null!=i&&(l=1));var m=this.uc(f),n=this.yc(f),o=f.sb();if(this.Ra())var o="rectangle",m=2*m,g=2*n,n=f.na()+m/2,p=f.ja()+g/2;else m*=g,g*=n,n=f.ja()+m/2,p=f.na()+g/2;h=new D.Yg(this.j(),o,null,n,p,m,g,null,h);h.Pb=f;null==i&&l==this.XO&&null==
k?(k="circle"==o?this.DEa:this.lDa,i=this.hAa):(m=this.E5,null!=i&&(D.TO.Zl()?m=[i]:(m=D.M.Dm(i,0.5),g=D.M.so(i,0.5),m=[m,i,g])),g=[l,l,l],k=null==k?"circle"==o?new D.ag(250,m,g):new D.ag(180,m,g):new D.tn(i,g[0]),i=new D.I(i,l));h.L(k);h.V(i);"none"!=this.Eq&&h.Jf(!0);i=this.Ja();l=this.ha(i-1);i>this.vq&&("tb"==l.getId()||"arr"==l.getId())?this.Ma(h,i-this.vq):this.k(h);f.Pe(h);this.rn(h,"_");(this.Ra()||"rectangle"==o||"diamond"==o||"triangleUp"==o||"triangleDown"==o||"plus"==o)&&"false"!=this.F5.Dca&&
(0,D.yi)(h)}else d[d.length]=f}this.B0(d);e=this.j();for(f=this.e8;0<f;f--)for(o=0;o<d.length;o++)i=d[o],f==i.lq&&(k=D.TO.ee(this.pb,this.Xb,i.getTime(),this.Ra()?this.Ua:this.Ga),h="_drn_"+i.getId(),l=9+5*i.lq,m=D.TO.ee(this.pb,this.Xb,i.Qh,this.Ra()?this.Ua:this.Ga),k=this.Ra()?this.kh()?new D.C(e,0,k,l,m-k,h):new D.C(e,this.Ga-l,k,l,m-k,h):this.kh()?new D.C(e,this.Ga-m,this.Ua-l-20,m-k,l,h):new D.C(e,k,this.Ua-l-20,m-k,l,h),k.L(new D.tn(i.xz)),h=new D.I(this.A("_","dbc"),1,1),k.V(h),(0,D.yi)(k),
k.Pb=i,this.k(k),i.FJ=k,i.lPa=l-2);this.removeChild(this.Voa);this.k(this.Voa);this.qt=c}};D.u.B0=function(a){this.e8=0;var b=null;null==this.GJ&&(this.GJ={});for(var c=0;c<a.length;c++){var d=a[c],e=d.getId(),f=e.substring(e.indexOf(":")+1,e.length),f=f.substring(0,f.indexOf(":"));f!=b&&(this.$w=0,b=f);d.lq=(0,D.FU)(this,d,a);null==d.xz&&(null==this.GJ[e]?(this.GJ[e]=this.$w,d.xz=this.V5[this.$w],this.$w++,this.$w==this.V5.length&&(this.$w=0)):d.xz=this.V5[this.GJ[e]])}};
D.u.WIa=function(){return this.GJ?this.GJ:null};D.CU.prototype.getDurationColorMap=D.CU.prototype.WIa;
D.EU=function(a,b,c,d,e,f){for(var g,h,i={max:1,S$:[]},k=a.Ra()?e:d,l=0;l<a.jn.length;l++){var m=a.jn[l];if(null!=m.Qh){var n=D.TO.ee(b,c,m.getTime(),k);(0,D.WO)(a)&&(n=k-n);m.ca(n)}else{var n=a,o=b,p=c,r=k,t=f/2,v=i,z=e,L=t*n.uc(m)+n.xX,J=t*n.yc(m)+n.xX,o=D.TO.ee(o,p,m.getTime(),r);(0,D.WO)(n)&&(o=r-o-2*L);if(n.Ra())t=0,"solid"==n.A("_","bs")&&(t=(0,window.parseInt)(n.A("_","bw"),10)),r=n.kh()?t+4:n.Ga-2*n.uc(m)-t-4;else for(var r=3,G=0,p=0;1>p;){g=n;h=v;var O=m.sb(),K=o,U=r,da=L,pa=J,ta=t,Aa=z;
"above"==g.XX&&(U+=(0,D.fP)(g));for(var kb=0;kb<h.S$.length;kb++){var Ha=h.S$[kb],fb=Ha.ja(),yc=Ha.na(),Lb=Ha.sb(),Wd=g.uc(Ha),Ha=g.yc(Ha),fb=window.Math.abs(K-fb),se=ta*Wd+g.xX+da;if(!(fb>=se)&&(Lb="circle"==O&&"circle"==Lb&&da==pa&&Wd==Ha?window.Math.sqrt(se*se-fb*fb):ta*Ha+g.xX+pa,Lb>window.Math.abs(U-yc)&&(U=yc+Lb,G=window.Math.max(G,U+Lb),1<=ta&&void 0!=Aa&&G>Aa)))break}g=U;h=G;g==r&&(p=1);G=h;r=g;p++}m.ca(o);m.va(r);v.S$.push(m);G>v.max&&(v.max=G);if(i.max>e)break}}return i.max>e&&1<f?(0,D.EU)(a,
b,c,d,e,f-1):f};D.FU=function(a,b,c){var d=c.length,e=b.getTime(),f=b.lq;null==f&&(f=1);for(var g=0;g<d;g++){var h=c[g];if(h!=b){var i=h.Qh;if(null!=i){var k=h.getTime(),h=h.lq;null==h&&(h=1);e>=k&&(e<=i&&f==h)&&(f=h+1,b.lq=f,f=(0,D.FU)(a,b,c))}}}f>a.e8&&(a.e8=f);return f};
D.CU.prototype.cU=function(a){var b=D.CU.o.cU.call(this,a);if(null!=b){if(null!=b.Pb){var c=b.Pb.BJ;null!=c&&this.j().fe().YM(a.pageX,a.pageY,c,"#000000");this.BH()&&this.setCursor("pointer")}if("none"!=this.Eq){a=!1;if(null!=this.qk)for(c=0;c<this.qk.length;c++)if(b==this.qk[c]){a=!0;break}a||(a=this.iH(b),c=new D.GU("highlight"),(0,D.xl)(c,"itemId",a),this.dispatchEvent(c),(0,D.HU)(this,b))}}};
D.CU.prototype.bU=function(a){a=D.CU.o.bU.call(this,a);if(null!=a&&!(0,D.sP)(a)){this.j().fe().Ac();var b=!1;if(null!=this.qk)for(var c=0;c<this.qk.length;c++)if(a==this.qk[c]){b=!0;break}b||(b=this.iH(a),c=new D.GU("unhighlight"),(0,D.xl)(c,"itemId",b),this.dispatchEvent(c),(0,D.IU)(this,a))}};
D.CU.prototype.qE=function(a,b,c){b=D.CU.o.qE.call(this,a,b,c);if(null!=b&&(a=a.ctrlKey||a.shiftKey||(0,D.Ef)(),"none"!=this.Eq)){c=this.iH(b);var d=new D.GU("selection");(0,D.xl)(d,"itemId",c);(0,D.xl)(d,"multiSelect",a);this.dispatchEvent(d);a=b.Pb.getTime();null!=a&&(c=new D.GU("scrollTime"),c.setTime(a),this.dispatchEvent(c),a=this.ha(1),b=this.Ra()?this.ja(b)-a.getHeight()/2:this.ja(b)-a.getWidth()/2,(0,D.hP)(this,b))}};
D.HU=function(a,b){if(null!=a.qk)for(var c=0;c<a.qk.length;c++)if(b==a.qk[c])return;a.rn(b,"_h")};D.IU=function(a,b){if(null!=a.qk)for(var c=0;c<a.qk.length;c++)if(b==a.qk[c])return;a.rn(b,"_")};D.qU=function(a,b){null==a.qk&&(a.qk=[]);var c=null;0<a.qk.length&&(c=a.qk[a.qk.length-1]);a.qk.push(b);null!=c&&a.rn(c,"_s");a.rn(b,"_as")};
D.CU.prototype.rn=function(a,b){if(a instanceof D.Yg){var c=!1,d=!1;if("solid"==this.A(b,"bs")){var c=!0,e=this.A(b,"bc");null==e&&(e="#000000");var f=this.A(b,"gc");null!=f&&"none"!=f&&(d=!0)}var g=a.ria,h=a.G6;!c&&null!=g?(this.removeChild(g),a.ria=null,null!=h&&(this.removeChild(h),a.G6=null)):!d&&null!=h&&(this.removeChild(h),a.G6=null);var i=a.Ta();if(c){var c=(0,window.parseInt)(this.A(b,"bw"),10),k=(0,window.parseInt)(this.A(b,"bof"),10);if(null==g){if("circle"==i){this.BH()&&(k=0);var l=(a.F().e+
2*k)*a.uc(),m=(a.F().g+2*k)*a.yc(),n=this.ja(a)-k+l/2,o=this.na(a)-k+m/2}else this.Ra()?(l=(a.F().e+(c+1))*a.uc(),m=(a.F().g+(c+1))*a.yc(),n=this.na(a)-(c+1)/2+l/2,o=this.ja(a)-(c+1)/2+m/2):(l=(a.F().e+2*k)*a.uc(),m=(a.F().g+2*k)*a.yc(),n=this.ja(a)-k+l/2,o=this.na(a)-k+m/2);g=new D.Yg(this.j(),i,null,n,o,l,m,null,a.getId()+"_border");this.Ma(g,this.Pf(a));a.ria=g;g.L(this.kma)}e=new D.I(e,this.A(b,"bo"),c);g.V(e);(this.Ra()||"rectangle"==i||"diamond"==i||"triangleUp"==i||"triangleDown"==i||"plus"==
i)&&"false"!=this.F5.Dca&&(0,D.yi)(g);d&&(null==h&&(h=k-c,"circle"==i?(this.BH()&&(h=0),l=(a.F().e+2*h)*a.uc(),m=(a.F().g+2*h)*a.yc(),n=this.ja(a)-h+l/2,o=this.na(a)-h+m/2):this.Ra()?(l=(a.F().e+3)*a.uc(),m=(a.F().g+3)*a.yc(),n=this.na(a)+l/2,o=this.ja(a)-1+m/2):(l=(a.F().e+2*h)*a.uc(),m=(a.F().g+2*h)*a.yc(),n=this.ja(a)-h+l/2,o=this.na(a)-h+m/2),h=new D.Yg(this.j(),i,null,n,o,l,m,null,a.getId()+"_glow"),this.Ma(h,this.Pf(g)),a.G6=h,h.L(this.kma)),f=new D.I(f,this.A(b,"go"),4),h.V(f),(this.Ra()||
"rectangle"==i||"diamond"==i||"triangleUp"==i||"triangleDown"==i||"plus"==i)&&"false"!=this.F5.Dca&&(0,D.yi)(h))}}else if((i=a.getId())&&"_drn_"==i.substring(0,5))i=this.A(b,"dbc"),null==i&&(i="#000000"),f=(0,window.parseInt)(this.A(b,"dbw"),10),a.V(new D.I(i,1,f))};D.CU.prototype.Df=function(){this.Oga||(this.Oga=new D.JU(this));return this.Oga};D.CU.prototype.getAutomation=D.CU.prototype.Df;
D.DU=function(a){this.Init(a)};D.w.l(D.DU,D.w,"DvtTimelineOverviewParser");D.u=D.DU.prototype;D.u.Init=function(a){this.H=a;this.tv=new D.fj};D.u.parse=function(a){var b=this.tv.parse(a);a=this.zE(b);var b=b.xc(),c;if(c=b[0]){var d={};d.width=c.v("width");d.height=c.v("height");d.NNa=c.xc();c=d}else c=null;a.Kta=c;a.FMa=this.S8(b[1],a.cqa);2<b.length&&(a.YHa=!b[2]?null:b[2].xc());return a};
D.u.zE=function(a){var b={};b.start=(0,window.parseInt)(a.v("start"));b.end=(0,window.parseInt)(a.v("end"));b.width=(0,window.parseInt)(a.v("width"));b.Uca=(0,window.parseInt)(a.v("renstart"));b.currentTime=(0,window.parseInt)(a.v("ocd"));b.orientation=a.v("orn");b.dta=a.v("ovp");b.cT=a.v("selmode");b.Zba=a.v("rtl");b.borderTopStyle=a.v("_bts");b.borderTopColor=a.v("_btc");b.rNa=a.v("sid");b.ypa=a.v("_aoc");var c={};c.shape=a.v("_ds");c.VH=a.v("_dsx");c.WH=a.v("_dsy");c.opacity=a.v("_do");c.color=
a.v("_fc");c.Dca=a.v("_ph");b.cqa=c;b.Hba=a.v("_hfc");b.Jba=a.v("_htc");b.Ora=a.v("_hbi");b.$ra=a.v("_hw");b.Xra=a.v("_hh");b.wda=a.v("_wbc");b.Eda=a.v("_wbts");b.Cda=a.v("_wbrs");b.yda=a.v("_wbbs");b.Ada=a.v("_wbls");b.Dda=a.v("_wbtc");b.Bda=a.v("_wbrc");b.xda=a.v("_wbbc");b.zda=a.v("_wblc");b.xca=a.v("_obc");b.daa=a.v("_ctic");b.pda=a.v("_tic");b.Ita=a.v("_tabc");b.Jta=a.v("_tabo");b.Zv=a.v("_ls");c={};c._bs=a.v("_bs");c._bc=a.v("_bc");c._bw=a.v("_bw");c._bof=a.v("_bof");c._bo=a.v("_bo");c._gc=
a.v("_gc");c._go=a.v("_go");c._dbs=a.v("_dbs");c._dbc=a.v("_dbc");c._dbw=a.v("_dbw");c._hbs=a.v("_hbs");c._hbc=a.v("_hbc");c._hbw=a.v("_hbw");c._hbof=a.v("_hbof");c._hbo=a.v("_hbo");c._hgc=a.v("_hgc");c._hgo=a.v("_hgo");c._hdbs=a.v("_hdbs");c._hdbc=a.v("_hdbc");c._hdbw=a.v("_hdbw");c._sbs=a.v("_sbs");c._sbc=a.v("_sbc");c._sbw=a.v("_sbw");c._sbof=a.v("_sbof");c._sbo=a.v("_sbo");c._sgc=a.v("_sgc");c._sgo=a.v("_sgo");c._sdbs=a.v("_sdbs");c._sdbc=a.v("_sdbc");c._sdbw=a.v("_sdbw");c._asbs=a.v("_asbs");
c._asbc=a.v("_asbc");c._asbw=a.v("_asbw");c._asbof=a.v("_asbof");c._asbo=a.v("_asbo");c._asgc=a.v("_asgc");c._asgo=a.v("_asgo");c._asdbs=a.v("_asdbs");c._asdbc=a.v("_asdbc");c._asdbw=a.v("_asdbw");b.TGa=c;return b};D.u.S8=function(a,b){if(!a)return null;for(var c=[],d=a.xc(),e=0;e<d.length;e++){var f=this.R2(d[e],b),f=new D.KU(this.H,f);c.push(f)}return c};
D.u.R2=function(a,b){var c={},d="true"==a.v("_sd");c.id=a.v("tid");c.Xca=a.v("rk");c.time=a.v("t");c.jD=a.v("et");c.shape=a.v("s");d&&null==c.shape&&(c.shape=b.shape);c.HZ=a.v("d");c.color=a.v("c");c.LZ=a.v("dfc");d&&null==c.color&&(c.color=b.color);c.VH=a.v("sx");d&&null==c.VH&&(c.VH=b.VH);c.WH=a.v("sy");d&&null==c.WH&&(c.WH=b.WH);c.XKa=a.v("g");c.opacity=a.v("o");d&&null==c.opacity&&(c.opacity=b.opacity);return c};
D.KU=function(a,b){this.Init(a,b)};D.w.l(D.KU,D.w,"DvtTimelineOverviewNode");D.u=D.KU.prototype;
D.u.Init=function(a,b){this.H=a;this.RQ=b.Xca;this.Xa=b.id;this.fGa=(0,window.parseInt)(b.time);this.Qh=null==b.jD?null:(0,window.parseInt)(b.jD);this.G="circle";"square"==b.shape?this.G="rectangle":"plus"==b.shape?this.G="plus":"diamond"==b.shape?this.G="diamond":"triangleUp"==b.shape?this.G="triangleUp":"triangleDown"==b.shape&&(this.G="triangleDown");this.BJ=b.HZ;this.fk=b.color;this.I6=b.XKa;null!=b.opacity&&(this.bEa=(0,window.parseFloat)(b.opacity));null!=b.VH&&(this.LFa=(0,window.parseFloat)(b.VH));
null!=b.WH&&(this.MFa=(0,window.parseFloat)(b.WH));null!=b.LZ&&(this.xz=b.LZ)};D.u.getId=(0,D.s)("Xa");D.u.mba=(0,D.s)("RQ");D.u.getTime=(0,D.s)("fGa");D.u.uc=(0,D.s)("LFa");D.u.yc=(0,D.s)("MFa");D.u.rb=(0,D.s)("fk");D.u.sb=(0,D.s)("G");D.u.eba=(0,D.s)("bEa");D.u.ia=(0,D.s)("ug");D.u.Pe=(0,D.q)("ug");D.u.ja=(0,D.s)("zb");D.u.ca=(0,D.q)("zb");D.u.na=(0,D.s)("Vb");D.u.va=(0,D.q)("Vb");
D.GU=function(a){this.Init("timeline");this.ym=a};D.w.l(D.GU,D.vP,"DvtTimelineOverviewEvent");D.GU.prototype.iH=function(){return this.Wi("itemId")};
D.JU=function(a){this.$b(a)};D.w.l(D.JU,D.xj,"DvtTimelineOverviewAutomation");D.JU.prototype.$b=(0,D.q)("kc");
D.JU.prototype.ol=function(a){var b=a.getId();if(a instanceof D.Yg){a=b.split(":");if(4!=a.length)return null;b=null==this.kc.EY?null:this.kc.EY.split(" ");if(null!=b&&(b=D.H.wa(b,a[1]),-1<b))return"marker["+b+"]["+a[2]+"]"}else{if("window"==b)return"range_window";if("lh"==b||"lhb"==b||"lbgrh"==b)return"range_start_handle";if("rh"==b||"rhb"==b||"rbgrh"==b)return"range_end_handle";if("grpy"==b)return a=a.getParent().LR(a),this.ol(a)}return null};
D.JU.prototype.Ff=function(a){for(var b=a.split("["),c=b.length,d=1;d<c;d++){var e=b[d],e=e.substr(0,e.length-1),f=(0,window.parseFloat)(e),e=(0,window.isNaN)(f)?e:f;b[d]=e}if(b&&3==b.length&&"marker"==b[0]){if(c=null==this.kc.EY?null:this.kc.EY.split(" "),null!=c&&(d=(0,window.parseInt)(b[1],10),-1<d&&d<c.length)){a:{a=this.kc.jn;b="tl1:"+c[d]+":"+b[2]+":";for(c=0;c<a.length;c++)if(d=a[c],e=d.getId(),null!=e&&0==e.indexOf(b)){b=d;break a}b=null}return b?b.ia().ta():null}}else{if("range_window"==
a)return this.kc.ha(1).ta();if("range_start_handle"==a)return this.kc.ha(this.kc.Ja()-this.kc.vq).ta();if("range_end_handle"==a)return(0,D.pP)(this.kc).ta()}return null};(0,D.ca)("DvtTimelineOverviewAutomation.prototype.getDomElementForSubId",D.JU.prototype.Ff);

  return D;
});